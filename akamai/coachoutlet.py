# -*- coding: utf-8 -*-
# Auto-generated by RiskByPass Task Panel
# Deps: pip install requests
import requests, time, json, sys

BASE_URL = "https://riskbypass.com"                     # API base URL
TOKEN    = "Your Token"                                 # Access token (sent as x-api-key)
TIMEOUT  = 60                                           # Timeout (seconds)
PROXY    = "http://username:password@host:port"         # Proxy string

def run_task():
    # Task JSON payload
    payload = {
        "task_type": "akamai",
        "proxy": PROXY,
        "target_url": "https://www.coachoutlet.com/shop/black-friday-deals/view-all",
        "akamai_js_url": "https://www.coachoutlet.com/8vlYgn/nA/3U/rq90/EOyl2iyErF/XYp5NcOQYDEwSw/DFcpSVE/KA4Tc/iYhAAM",
        "page_fp": "5f585f5b4e495c515f42435b45474f485c5148"
    }

    session = requests.Session()
    headers = {"Content-Type": "application/json", "x-api-key": TOKEN}

    print("Submitting taskâ€¦")

    try:
        resp = session.post(f"{BASE_URL}/task/submit", headers=headers, json=payload, timeout=30)
        resp.raise_for_status()
        data = resp.json()
    except Exception as e:
        print("Submit request error:", repr(e))
        return

    if not data.get("ok"):
        print("Submit failed:", data)
        return

    task_id = data.get("task_id")
    if not task_id:
        print("No task_id in response:", data)
        return

    print("Submitted, task_id =", task_id)
    
    start_time = time.time()

    while True:
        if time.time() - start_time > TIMEOUT:
            print("Timeout (seconds)")
            return
        try:
            r = session.get(f"{BASE_URL}/task/result/{task_id}", headers={"Cache-Control":"no-cache"}, timeout=30)
            r.raise_for_status()
            j = r.json()
        except Exception as e:
            print("Polling error:", repr(e))
            time.sleep(1)
            continue

        st = j.get("status", "UNKNOWN")
        print("status:", st)

        if st in ("RUNNING", "QUEUED"):
            time.sleep(1)
            continue

        if st == "SUCCESS":
            print("SUCCESS, result:", json.dumps(j.get("result"), ensure_ascii=False, indent=4))
            return j.get("result")
        elif st == "FAILED":
            print("FAILED:", j.get("error", j))
            return
        elif st == "NOT_FOUND":
            print("NOT_FOUND: maybe invalid or recycled task_id")
            return
        else:
            print("UNKNOWN:", j)
            return

if __name__ == "__main__":
    result = run_task()
    cookies = result.get('cookies_dict')
    from curl_cffi import requests as c_requests

    headers = {
        'accept': '*/*',
        'accept-language': 'en',
        'cache-control': 'no-cache',
        'content-type': 'text/plain;charset=UTF-8',
        'origin': 'https://www.coachoutlet.com',
        'pragma': 'no-cache',
        'priority': 'u=1, i',
        'referer': 'https://www.coachoutlet.com/products/fiona-zip-tote-bag-in-signature-canvas/CBT18-IMXAQ.html',
        'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36',
        'x-sid': 'cbc875e9-8003-4efe-ae0a-2d2becf9f0dd',
    }

    params = {
        'locale': 'en-US',
        '__v__': 'c8pisjcGqMT8pkohqF9E9',
    }

    data = '{"sku":"CBT18 IMXAQ","quantity":1,"basketId":"1f3e6ae87903c523b7f285088d","token":"Bearer eyJ2ZXIiOiIxLjAiLCJqa3UiOiJzbGFzL3Byb2QvYmdwd19wcmQiLCJraWQiOiI3YzkyNDdlNi0xNWNjLTQ2NjQtYmIyMy1lNmIzNDZhNDRlMmQiLCJ0eXAiOiJqd3QiLCJjbHYiOiJKMi4zLjQiLCJhbGciOiJFUzI1NiJ9.eyJhdXQiOiJHVUlEIiwic2NwIjoic2ZjYy5zaG9wcGVyLW15YWNjb3VudC5iYXNrZXRzIGNfZ2V0TWluUHJvZHVjdEluZm9fciBzZmNjLnNob3BwZXItZGlzY292ZXJ5LXNlYXJjaCBzZmNjLnNob3BwZXItbXlhY2NvdW50LnBheW1lbnRpbnN0cnVtZW50cyBzZmNjLnNob3BwZXItY3VzdG9tZXJzLmxvZ2luIHNmY2Muc2hvcHBlci1teWFjY291bnQub3JkZXJzIHNmY2Muc2hvcHBlci1wcm9kdWN0bGlzdHMgc2ZjYy5zaG9wcGVyLWN1c3RvbS1vYmplY3RzIHNmY2Muc2hvcHBlci1wcm9tb3Rpb25zIHNmY2Muc2hvcHBlci1teWFjY291bnQucGF5bWVudGluc3RydW1lbnRzLnJ3IHNmY2Muc2hvcHBlci1teWFjY291bnQucHJvZHVjdGxpc3RzIHNmY2Muc2hvcHBlci1jYXRlZ29yaWVzIHNmY2Muc2hvcHBlci1teWFjY291bnQgc2ZjYy5zaG9wcGVyLW15YWNjb3VudC5hZGRyZXNzZXMgc2ZjYy5zaG9wcGVyLXByb2R1Y3RzIHNmY2Muc2hvcHBlci1teWFjY291bnQucncgc2ZjYy5zaG9wcGVyLXN0b3JlcyBzZmNjLnB3ZGxlc3NfbG9naW4gc2ZjYy5zaG9wcGVyLWJhc2tldHMtb3JkZXJzIHNmY2Muc2hvcHBlci1jdXN0b21lcnMucmVnaXN0ZXIgc2ZjYy5zaG9wcGVyLW15YWNjb3VudC5hZGRyZXNzZXMucncgc2ZjYy5zaG9wcGVyLW15YWNjb3VudC5wcm9kdWN0bGlzdHMucncgc2ZjYy5zaG9wcGVyLWJhc2tldHMtb3JkZXJzLnJ3IGNfZnVsbFByb2R1Y3RzX3Igc2ZjYy5zaG9wcGVyLWdpZnQtY2VydGlmaWNhdGVzIHNmY2Muc2hvcHBlci1wcm9kdWN0LXNlYXJjaCBzZmNjLnRzX2V4dF9vbl9iZWhhbGZfb2YiLCJzdWIiOiJjYy1zbGFzOjpiZ3B3X3ByZDo6c2NpZDpjOTViNWY4MS1lN2NmLTQyYWQtOWZiNi05MTBjNzA5NDA2ZTk6OnVzaWQ6Y2JjODc1ZTktODAwMy00ZWZlLWFlMGEtMmQyYmVjZjlmMGRkIiwiY3R4Ijoic2xhcyIsImlzcyI6InNsYXMvcHJvZC9iZ3B3X3ByZCIsImlzdCI6MSwiZG50IjoiMCIsImF1ZCI6ImNvbW1lcmNlY2xvdWQvcHJvZC9iZ3B3X3ByZCIsIm5iZiI6MTc2NDMzMDUxMCwic3R5IjoiVXNlciIsImlzYiI6InVpZG86c2xhczo6dXBuOkd1ZXN0Ojp1aWRuOkd1ZXN0IFVzZXI6OmdjaWQ6YmN3MGhIbWJBWnhySVJtYmFVa1dZWXh1eEo6OmNoaWQ6Y29oX3VzX291dCIsImV4cCI6MTc2NDMzMjM0MCwiaWF0IjoxNzY0MzMwNTQwLCJqdGkiOiJDMkMxODgzNjQ5NTA3MC00OTI2NDk1ODI2NjQwMDEyNjg2OTkzMDIwIn0.uFQj3Mh_RG8nSkHumTE1K88TMFkr8XvI1l7XZSAgRopDP5uGVz3fgY7z_rOEMYSHLKjkOkyYgU5mNRLsiwm0uQ","isApplePayEligible":false}'

    response = c_requests.post('https://www.coachoutlet.com/api/add-to-cart', params=params, cookies=cookies, headers=headers, data=data, proxy=PROXY)
    print(response.text)